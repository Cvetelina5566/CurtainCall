<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: radial-gradient(circle at top, #2e1437 0, #0b1020 45%, #050812 100%);
            color: #f9fafb;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .card {
            background: rgba(15, 23, 42, 0.95);
            border-radius: 1rem;
            padding: 2.5rem 2.75rem;
            width: 100%;
            max-width: 420px;
            box-shadow:
                0 24px 60px rgba(15, 23, 42, 0.9),
                0 0 0 1px rgba(148, 163, 184, 0.15);
        }
        .title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-align: center;
        }
        .subtitle {
            font-size: 0.9rem;
            color: #9ca3af;
            text-align: center;
            margin-bottom: 1.75rem;
        }
        label {
            display: block;
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 0.35rem;
            color: #e5e7eb;
        }
        input {
            width: 100%;
            padding: 0.65rem 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #4b5563;
            background-color: #020617;
            color: #f9fafb;
            font-size: 0.95rem;
            transition: border-color 0.15s, box-shadow 0.15s, background-color 0.15s;
        }
        input:focus {
            outline: none;
            border-color: #f97316;
            box-shadow: 0 0 0 1px #f97316;
            background-color: #020617;
        }
        .field {
            margin-bottom: 1rem;
        }
        .btn {
            width: 100%;
            padding: 0.8rem 1rem;
            border-radius: 999px;
            border: none;
            background: linear-gradient(135deg, #b91c1c, #f97316);
            color: #f9fafb;
            font-weight: 600;
            font-size: 0.98rem;
            cursor: pointer;
            margin-top: 0.75rem;
            transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.1s ease;
            box-shadow: 0 12px 30px rgba(248, 113, 113, 0.5);
        }
        .btn:hover {
            filter: brightness(1.05);
            transform: translateY(-1px);
            box-shadow: 0 16px 40px rgba(248, 113, 113, 0.6);
        }
        .btn:active {
            transform: translateY(0);
            box-shadow: 0 10px 24px rgba(248, 113, 113, 0.45);
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            box-shadow: none;
        }
        .message {
            margin-top: 1rem;
            font-size: 0.9rem;
            white-space: pre-line;
        }
        .message.error {
            color: #fecaca;
        }
        .message.success {
            color: #bbf7d0;
        }
        .footer {
            margin-top: 1.25rem;
            font-size: 0.85rem;
            color: #9ca3af;
            text-align: center;
        }
        .footer a {
            color: #f97316;
            font-weight: 500;
            text-decoration: none;
        }
        .footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1 class="title">Create your CurtainCall account ðŸŽ­</h1>
        <p class="subtitle">Sign up with your email to start managing your theatre projects.</p>

        <form id="registerForm" novalidate>
            <div class="field">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" autocomplete="email" required />
            </div>

            <div class="field">
                <label for="password1">Password</label>
                <input type="password" id="password1" name="password1" autocomplete="new-password" required />
            </div>

            <div class="field">
                <label for="password2">Confirm password</label>
                <input type="password" id="password2" name="password2" autocomplete="new-password" required />
            </div>

            <button type="submit" class="btn" id="submitBtn">
                Create account
            </button>
        </form>

        <div id="message" class="message"></div>

        <p class="footer">
            Already have an account?
            <a href="/accounts/login/">Log in</a>
        </p>
    </div>

    <script>
        const form = document.getElementById("registerForm");
        const messageEl = document.getElementById("message");
        const submitBtn = document.getElementById("submitBtn");

        form.addEventListener("submit", async (event) => {
            event.preventDefault();
            messageEl.textContent = "";
            messageEl.className = "message";

            const email = form.email.value.trim();
            const password1 = form.password1.value;
            const password2 = form.password2.value;

            if (!email || !password1 || !password2) {
                messageEl.classList.add("error");
                messageEl.textContent = "Please fill in all fields.";
                return;
            }
            if (password1 !== password2) {
                messageEl.classList.add("error");
                messageEl.textContent = "Passwords do not match.";
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = "Creating account...";

            try {
                const response = await fetch("http://127.0.0.1:8000/auth/app/signup/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Accept": "application/json",
                    },
                    body: JSON.stringify({ email, password1, password2 }),
                });

                const data = await response.json().catch(() => ({}));

                if (response.ok) {
                    messageEl.classList.add("success");
                    messageEl.textContent =
                        "Registration successful! Please check your email (if verification is required) and then log in.";
                    form.reset();
                } else {
                    messageEl.classList.add("error");

                    // allauth usually returns field-wise errors: { "email": ["..."], "password1": ["..."] }
                    if (data && typeof data === "object") {
                        const lines = [];
                        Object.entries(data).forEach(([field, msgs]) => {
                            if (Array.isArray(msgs)) {
                                lines.push(field + ": " + msgs.join(", "));
                            } else if (typeof msgs === "string") {
                                lines.push(field + ": " + msgs);
                            }
                        });
                        messageEl.textContent = lines.length
                            ? lines.join("\n")
                            : "Something went wrong while creating your account.";
                    } else {
                        messageEl.textContent = "Something went wrong while creating your account.";
                    }
                }
            } catch (error) {
                console.error(error);
                messageEl.classList.add("error");
                messageEl.textContent = "Network error. Please try again in a moment.";
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = "Create account";
            }
        });
    </script>
</body>
</html>
